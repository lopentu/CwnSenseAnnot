(this["webpackJsonpsense-annot"]=this["webpackJsonpsense-annot"]||[]).push([[0],{114:function(e,n,t){e.exports=t(134)},119:function(e,n,t){},129:function(e,n,t){},132:function(e,n,t){},134:function(e,n,t){"use strict";t.r(n);var r=t(0),a=t.n(r),o=t(41),i=t.n(o),c=(t(119),t(11)),s=t(178),l=t(188);function u(e){var n={root:{color:"white",fontSize:"small",textDecoration:"underline"}};return e.user?a.a.createElement(s.a,{horizontal:!0},a.a.createElement("div",null,e.user.name),a.a.createElement("div",{style:{paddingLeft:"10pt"}},a.a.createElement(l.a,{styles:n,onClick:e.logout_fn},"Logout"))):a.a.createElement(s.a,{horizontal:!0},a.a.createElement("div",null,"Not logged in"),a.a.createElement("div",null,a.a.createElement(l.a,{styles:n,onClick:e.login_fn},"Login")))}function d(e){if(null!==e.session){var n=e.session,t=new Date(n.lastActivity).toLocaleString("en-GB");return a.a.createElement(s.a,{id:"session-wrapper"},a.a.createElement("div",{style:{fontSize:"small"}},"Last activity:"),a.a.createElement("div",{style:{fontSize:"small"}},t))}return a.a.createElement(s.a,{id:"session-wrapper"})}var p=t(191),f=t(192);function m(e,n,t){return n.map((function(n){var r=n.assignId,a=n.items.length,o=0,i=0;if(r in t){var c=function(e,n){return Object.values(e[n].results).reduce((function(e,n){return n.probs.length>0&&(e.nDone+=n.probs[0]>=.8?1:0,e.nAmbig+=n.probs[0]<.8?1:0),e}),{nDone:0,nAmbig:0})}(t,r);o=c.nDone,i=c.nAmbig}return{name:n.assignId,nTotal:a,nDone:o,nAmbig:i,checked:n.assignId===e}}))}var g=t(69),v=t(196);function h(e){return a.a.createElement(v.a,{items:e.items,onRenderCell:function(n,t){var r={root:{padding:"1px",height:"24pt"},icon:{color:"white"},iconHovered:{color:"white"},rootHovered:{border:"1px solid white",borderRadius:"5px"}};if(n){var o=n.checked?a.a.createElement(g.a,{styles:r,iconProps:{iconName:"MSNVideosSolid"},checked:!1}):a.a.createElement(g.a,{styles:r,onClick:function(){return e.onAssignIdChanged(n.name)},iconProps:{iconName:"MSNVideos"},checked:!1});return a.a.createElement(s.a,{horizontal:!0},a.a.createElement(s.a.Item,{align:"center"},o),a.a.createElement(s.a.Item,{grow:1,align:"center"},n.name),a.a.createElement(s.a.Item,{align:"center"},n.nDone,"/",n.nAmbig,"/",n.nTotal))}return null}})}var b=t(101),E=t(190),I=t(181);function x(e){var n={root:{color:"white",border:"1px solid white",borderRadius:"5px"}};return a.a.createElement(a.a.Fragment,null,a.a.createElement(s.a,{horizontal:!0,horizontalAlign:"space-evenly"},a.a.createElement(b.a,{styles:n,onClick:e.onPrevTrial,iconProps:{iconName:"CaretSolidLeft"},title:"Previous Item"}),a.a.createElement(b.a,{styles:n,iconProps:{iconName:"CaretLeft8"},title:"Previous Todo"}),a.a.createElement(b.a,{styles:n,iconProps:{iconName:"CaretRight8"},title:"Next Todo"}),a.a.createElement(b.a,{styles:n,onClick:e.onNextTrial,iconProps:{iconName:"CaretSolidRight"},title:"Next Item"})),a.a.createElement(s.a,{horizontal:!0},a.a.createElement(s.a.Item,null,a.a.createElement(E.a,{styles:{root:{color:"white",minWidth:"70px"}}},"Go to Item")),a.a.createElement(s.a.Item,{grow:1},a.a.createElement(I.a,{styles:{root:{width:"100%"}},defaultValue:(e.currentItemNo+1).toString()}))))}function y(e,n){if(e){var t=e.currentAssignmentId,r=n.filter((function(e){return e.assignId==t}));return r.length>0?r[0]:null}return null}function O(e,n){var t=null===e||void 0===e?void 0:e.currentItemId;return n&&t?n.items.indexOf(t):-1}function k(e){e.assignments,e.annotations;var n=e.session,t=y(e.session,e.assignments),r=O(e.session,t);if(null===n)return null;var o=m(n.currentAssignmentId,e.assignments,e.annotations),i=function(e){var n=e.reduce((function(e,n){return e.nDone+=n.nDone,e.nTotal+=n.nTotal,e}),{nDone:0,nTotal:0});return n.nDone/n.nTotal}(o),c=function(n){var t=y(e.session,e.assignments);if(t&&n>=0&&n<t.items.length){var r=t.items[n];e.onItemIdChanged(r)}};return a.a.createElement(s.a,{tokens:{childrenGap:10}},a.a.createElement(p.a,{styles:{itemName:{color:"white"}},label:"".concat(Math.round(1e4*i)/100,"% Complete"),percentComplete:i}),a.a.createElement(x,{currentItemNo:r,onPrevTrial:function(){var n=y(e.session,e.assignments),t=O(e.session,n);c(t-1)},onNextTrial:function(){var n=y(e.session,e.assignments),t=O(e.session,n);c(t+1)}}),a.a.createElement(f.a,null),a.a.createElement(h,{onAssignIdChanged:e.onAssignIdChanged,items:o}))}var w=t(8),j=t.n(w),S=t(13),C=t(27);t(82);function D(e){var n=function(e){return e||""};return{name:n(e.displayName),email:n(e.email),photoUrl:n(e.photoURL),uid:n(e.uid)}}function N(){return _.apply(this,arguments)}function _(){return(_=Object(S.a)(j.a.mark((function e(){var n,t,r,a;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("login function called"),n=new C.auth.GoogleAuthProvider,e.prev=2,e.next=5,C.auth().setPersistence(C.auth.Auth.Persistence.LOCAL).then((function(){return C.auth().signInWithPopup(n)}));case 5:if(!(t=e.sent).credential){e.next=12;break}return t.credential.accessToken,r=null,(a=t.user)&&(r=D(a)),e.abrupt("return",r);case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(2),console.debug(e.t0);case 17:case"end":return e.stop()}}),e,null,[[2,14]])})))).apply(this,arguments)}function T(){C.auth().signOut()}var A=t(23),z=t.n(A);function P(e){return G.apply(this,arguments)}function G(){return(G=Object(S.a)(j.a.mark((function e(n){var t,r,a;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=z.a.firestore(),e.next=3,t.collection("senses").doc(n).get();case 3:if(!(r=e.sent).exists){e.next=9;break}return a=r.data(),e.abrupt("return",a.senses);case 9:throw new Error("Cannot find lemma "+n);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function R(e){return U.apply(this,arguments)}function U(){return(U=Object(S.a)(j.a.mark((function e(n){var t,r;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=z.a.firestore(),e.next=3,t.collection("sessions").doc(n.uid).get();case 3:if(!(r=e.sent).exists){e.next=8;break}return e.abrupt("return",r.data());case 8:return e.abrupt("return",null);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function L(e){return M.apply(this,arguments)}function M(){return(M=Object(S.a)(j.a.mark((function e(n){var t,r,a;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=z.a.firestore(),e.next=3,t.collection("assignments").get();case 3:return r=e.sent,a=[],r.forEach((function(e){a.push(e.data())})),e.abrupt("return",a);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function H(e){return F.apply(this,arguments)}function F(){return(F=Object(S.a)(j.a.mark((function e(n){var t,r,a;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=z.a.firestore(),e.next=3,t.collection("assignments").where("annotatorId","==",n.uid).get();case 3:return r=e.sent,a={},r.forEach((function(e){var n=e.data();a[n.assignId]=n})),e.abrupt("return",a);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function W(e){return B.apply(this,arguments)}function B(){return(B=Object(S.a)(j.a.mark((function e(n){var t,r,a,o;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=z.a.firestore(),e.next=3,t.collection("sentences").doc(n).get();case 3:if(!(r=e.sent).exists){e.next=10;break}return a=r.data(),o=a.tokens.map((function(e){return e.split("::")})),e.abrupt("return",o);case 10:return e.abrupt("return",[]);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function V(e,n){return Y.apply(this,arguments)}function Y(){return(Y=Object(S.a)(j.a.mark((function e(n,t){var r,a,o,i;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=z.a.firestore(),a="".concat(n,"-").concat(t),o=null,e.next=5,r.collection("senseTrees").doc(a).get();case 5:return(i=e.sent).exists&&(o=i.data()),e.abrupt("return",o);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function J(){return(J=Object(S.a)(j.a.mark((function e(n,t){var r;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=null,null===n){e.next=15;break}return e.prev=2,e.next=5,R(n);case 5:r=e.sent,console.debug(r),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(2),console.error(e.t0);case 12:null===r&&(r={userId:n.uid,userEmail:n.email,lastActivity:Date.now(),currentAssignmentId:"",currentItemId:""}),e.next=16;break;case 15:r=null;case 16:t(r);case 17:case"end":return e.stop()}}),e,null,[[2,9]])})))).apply(this,arguments)}function Z(){return(Z=Object(S.a)(j.a.mark((function e(n,t){var r;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=[],null===n){e.next=14;break}return e.prev=2,e.next=5,L(n);case 5:r=e.sent,e.next=12;break;case 8:e.prev=8,e.t0=e.catch(2),console.error(e.t0),r=[];case 12:e.next=15;break;case 14:r=[];case 15:t(r);case 16:case"end":return e.stop()}}),e,null,[[2,8]])})))).apply(this,arguments)}function q(){return(q=Object(S.a)(j.a.mark((function e(n,t){var r;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r={},null===n){e.next=13;break}return e.prev=2,e.next=5,H(n);case 5:r=e.sent,e.next=11;break;case 8:e.prev=8,e.t0=e.catch(2),console.error(e.t0);case 11:e.next=13;break;case 13:t(r);case 14:case"end":return e.stop()}}),e,null,[[2,8]])})))).apply(this,arguments)}function K(){return(K=Object(S.a)(j.a.mark((function e(n,t){var r,a,o,i,c,s;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r={},!(n&&n.currentItemId.length>0)){e.next=12;break}return a=n.currentItemId,o=n.currentAssignmentId,i=a.split(":")[0],c=parseInt(a.split(":")[1]),e.next=8,W(i);case 8:s=e.sent;try{r={sentenceId:i,sentence:s,token:s[c],userEmail:n.userEmail,userId:n.userId,assignId:o,itemId:a}}catch(l){console.error(l)}e.next=12;break;case 12:t(r);case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Q(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=Object.assign({},e);return n.length>0&&(r.currentAssignmentId=n),t.length>0&&(r.currentItemId=t),r.lastActivity=Date.now(),r}function X(e,n){var t=n.userEmail;return{annotId:"".concat(t,":").concat(e),annotatorId:n.userId,assignId:e,results:{}}}var $=function(e){return a.a.createElement(s.a,{tokens:{childrenGap:5,padding:10}},a.a.createElement(u,{user:e.user,login_fn:e.login_fn,logout_fn:e.logout_fn}),a.a.createElement(d,{session:e.session}),a.a.createElement(k,{session:e.session,assignments:e.assignments,annotations:e.annotations,onItemIdChanged:function(n){var t=y(e.session,e.assignments);if(t&&t.items.indexOf(n)>=0){var r=Q(e.session,t.assignId,n);e.onSessionUpdated(r)}},onAssignIdChanged:function(n){var t=e.assignments.filter((function(e){return e.assignId==n}));if(t.length>0){var r=t[0],a=Q(e.session,n,r.items[0]);e.onSessionUpdated(a)}}}))};t(129);function ee(e){var n=e.token,t=e.isFocus,r=e.token[1].endsWith("CATEGORY")?"":e.token[1];return a.a.createElement(s.a,{horizontalAlign:"center"},a.a.createElement("div",{style:{fontSize:"10pt"}},r)," ",a.a.createElement("div",{style:{fontSize:"large"},title:"".concat(n[2],":").concat(n[3]),className:t?"focus-token":""},n[0])," ")}var ne=function(e){var n=e.sentence,t=e.itemId;if(void 0===n)return null;var r=-1;try{r=parseInt(t.split(":")[1])}catch(o){}return a.a.createElement("div",{className:"row"},a.a.createElement("div",{className:"mx-auto mt-4"},a.a.createElement("div",{className:"card-body bg-light p-3 mb-3 border border-primary rounded-lg"},a.a.createElement(s.a,{horizontal:!0,tokens:{childrenGap:3}},n.map((function(e,n){var t=r==n;return a.a.createElement(ee,{token:e,isFocus:t})}))))))},te=t(47);function re(e){return e.children.length>0?e.children.map((function(e){return"group"===e.node_type?re(e):1})).reduce((function(e,n){return e+n}),0):0}function ae(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,t=e.children.filter((function(e){return"group"===e.node_type})).map((function(e){return ae(e,n+1)})),r={key:e.node_id,name:e.title,data:{tag:e.tag,description:e.description,allCount:re(e)},level:n,children:t};return r}function oe(e,n){var t=ie(e,n);return t.length>0?t[0]:null}function ie(e,n){return ce(e,n).map((function(e){return e[e.length-1]}))}function ce(e,n){for(var t=[[e,[]]],r=[],a=function(){var e=t.pop(),a=Object(c.a)(e,2),o=a[0],i=a[1],s=[].concat(Object(te.a)(i),[o]);n(o)&&r.push(s),o.children.map((function(e){return t.push([e,s])}))};t.length>0;)a();return r}function se(e,n){var t=ce(e,(function(e){return e==n}));return t.length&&t[0].length>1?t[0][t[0].length-2]:null}function le(e,n,t){var r=Object.assign({},e),a=se(e,t),o=se(e,n);if("group"===t.node_type){if(o){var i=o.children.indexOf(n);o.children.splice(i,1),t.children.push(n)}}else if(a&&o){var c=o.children.indexOf(n);o.children.splice(c,1);var s=a.children,l=s.indexOf(t),u=[].concat(Object(te.a)(s.slice(0,l+1)),[n],Object(te.a)(s.slice(l+1,s.length)));a.children=u}return r}function ue(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return e.children.length>0?e.children.map((function(n){return ue(n,e)})).flat():[{node:e,parent:n}]}function de(e,n){var t=ue(e).map((function(e){var t=n.map((function(e){return e.cwn_id})).indexOf(e.node.node_id),r=null;return t>=0&&(r=n[t]),{sense:r,parent:e.parent}})).filter((function(e){return!!e.sense})),r=t.map((function(e){return e.sense})),a=t.map((function(e){return e.parent})),o=r.reduce((function(e,n,t){var r=a[t],o=r?r.node_id:"__null__";return e[o]=[].concat(Object(te.a)(e[o]||[]),[n]),e}),{}),i=Object.values(o).flat(),c=Object.keys(o).map((function(n){var t=o[n],r=oe(e,(function(e){return e.node_id===n})),c=(null===r||void 0===r?void 0:r.title)?null===r||void 0===r?void 0:r.title:n;return{count:t.length,startIndex:i.indexOf(t[0]),key:n,name:c,data:a.filter((function(e){return e&&e.node_id==n}))[0],level:0}}));return{senses:i,groups:c}}function pe(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return{node_id:"group-".concat(Date.now()),description:"",node_type:"group",title:e.length>0?e:"New Group",tag:"",children:[]}}function fe(e){return{node_id:e.cwn_id,description:"",node_type:"sense",title:"(".concat(e.pos,")").concat(e.definition),tag:"",children:[]}}function me(e){return{annotator:e.userEmail,annotatorId:e.userId,timestamp:Date.now(),lemma:e.token[0],root:pe("Root Group")}}function ge(){return(ge=Object(S.a)(j.a.mark((function e(n,t){var r,a,o;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.token,a=[],!r){e.next=13;break}return o=r[0],e.prev=4,e.next=7,P(o);case 7:a=e.sent,e.next=13;break;case 10:e.prev=10,e.t0=e.catch(4),console.error(e.t0);case 13:t(a);case 14:case"end":return e.stop()}}),e,null,[[4,10]])})))).apply(this,arguments)}function ve(){return(ve=Object(S.a)(j.a.mark((function e(n){var t,r,a,o;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=null,!n){e.next=14;break}return r=n.userEmail,a=n.token,o=a[0],e.prev=5,e.next=8,V(r,o);case 8:t=e.sent,e.next=13;break;case 11:e.prev=11,e.t0=e.catch(5);case 13:null===t&&(t=me(n));case 14:return e.abrupt("return",t);case 15:case"end":return e.stop()}}),e,null,[[5,11]])})))).apply(this,arguments)}var he=t(173),be=t(176),Ee=t(24),Ie=t(74),xe=t(180),ye=t(54),Oe=t(10),ke=t(177),we=t(2),je=t(183),Se=t(184);var Ce=function(e){var n=e.sense,t=e.index,o=Object(r.useRef)(null),i=Object(je.a)({item:{type:"leaf-node",senseId:n.cwn_id},collect:function(e){return{isDragging:!!e.isDragging()}}}),s=Object(c.a)(i,2);Object(Ie.a)(s[0]);var l,u=s[1],d=Object(Se.a)({accept:"leaf-node",drop:function(t,r){e.onDragAndDrop(t.senseId,n.cwn_id)},canDrop:function(e,n){return!0}}),p=Object(c.a)(d,2);return Object(Ie.a)(p[0]),u((0,p[1])(o)),n&&void 0!==t?a.a.createElement("div",{ref:o},a.a.createElement(xe.a,{tooltipProps:(l=n.examples,{onRenderContent:function(){return a.a.createElement("ul",null,l.map((function(e){return a.a.createElement("li",null,e)})))}}),id:"tp"+n.cwn_id,delay:ye.a.long,directionalHint:Oe.a.rightCenter},a.a.createElement(ke.a,{imageInitials:n.pos,initialsColor:t%6,text:n.definition,secondaryText:n.examples[0],size:we.c.size32,showSecondaryText:!0,onClick:e.onClick,styles:{root:{marginTop:"7px",userSelect:"none"},primaryText:{fontSize:"11pt",userSelect:"none"},secondaryText:{fontSize:"8pt",color:"gray",userSelect:"none"}}}))):a.a.createElement("div",null)},De=new he.a({onSelectionChanged:function(){console.log(De.getSelection())}});function Ne(e){var n=[],t=[];function r(n,t){var r=e.senseTree;if(r){var a=oe(r.root,(function(e){return e.node_id==n})),o=oe(r.root,(function(e){return e.node_id==t}));if(a&&o){var i=le(r.root,a,o),c=Object.assign({},r);c.timestamp=Date.now(),c.root=i,e.onSenseTreeUpdated(c)}}}return Object.keys(e.groupedSenses).length>0&&(n=e.groupedSenses.senses,t=e.groupedSenses.groups),a.a.createElement("div",{id:"unique-sense-list-id",ref:null,style:{height:"500px",overflowX:"hidden",overflowY:"scroll"}},a.a.createElement(be.a,{items:n,groups:t,onRenderCell:function(n,t,o){if(t&&void 0!==o)return a.a.createElement(Ce,{sense:t,index:o,onDragAndDrop:r,onClick:function(){return e.onSenseSelected(t)}})},compact:!0,selectionMode:Ee.b.none,groupProps:{showEmptyGroups:!0}}))}var _e=t(35),Te=t(96),Ae=t(4),ze=t(193),Pe=t(186),Ge=t(95);function Re(e){var n=Object(r.useState)(e.groupInfo),t=Object(c.a)(n,2),o=t[0],i=t[1],l=Object(Ae.x)({root:{padding:"5%"},label:{width:"60px",margin:"1% 0%"},textInput:{}});return a.a.createElement(ze.a,{role:"alertdialog",gapSpace:0,target:"#".concat(e.elemId),onDismiss:e.onDismiss,setInitialFocus:!0},a.a.createElement(s.a,{className:l.root},a.a.createElement(s.a,{horizontal:!0},a.a.createElement(E.a,{className:l.label},"Title"),a.a.createElement(I.a,{className:l.textInput,onChange:function(e,n){return i(Object(_e.a)(Object(_e.a)({},o),{},{title:n||""}))},defaultValue:o.title})),a.a.createElement(s.a,{horizontal:!0},a.a.createElement(E.a,{className:l.label},"Tag"),a.a.createElement(I.a,{className:l.textInput,onChange:function(e,n){return i(Object(_e.a)(Object(_e.a)({},o),{},{tag:n||""}))},defaultValue:o.tag})),a.a.createElement(s.a,{horizontal:!0,horizontalAlign:"end",tokens:{childrenGap:"10px"},styles:{root:{paddingTop:"16px"}}},a.a.createElement(Pe.a,{onClick:e.onDismiss},"Cancel"),a.a.createElement(Ge.a,{onClick:function(){i(o),e.onGroupInfoUpdate(o),e.onDismiss()}},"Save"))))}function Ue(e){var n=function(){e.onToggleCollapse(e.group)},t=Object(r.useState)(!1),o=Object(c.a)(t,2),i=o[0],l=o[1],u=function(){l(!i)},d=Object(r.useRef)(null),p=Object(Se.a)({accept:["group-node","leaf-node"],drop:function(n,t){var r=e.group.key;"group-node"==n.type?e.onDragAndDrop(n.nodeId,r):e.onDragAndDrop(n.senseId,r)},canDrop:function(n,t){return"leaf-node"==n.type||n.nodeId!=e.group.key}}),f=Object(c.a)(p,2),m=f[0],g=(m.isOver,m.canDrop,f[1]),v=Object(je.a)({item:{type:"group-node",nodeId:e.group.key},collect:function(e){return{isDragging:!!e.isDragging()}}}),h=Object(c.a)(v,3),E=(h[0].isDragging,h[1]);h[2];if(e.group){E(g(d));var I={title:e.group.name,tag:e.group.data.tag},x=I.tag,y=null;y=e.group.isCollapsed?a.a.createElement(b.a,{onClick:n,iconProps:{iconName:"ChevronDown"},title:"\u5c55\u958b"}):a.a.createElement(b.a,{onClick:n,iconProps:{iconName:"ChevronRight"},title:"\u6536\u8d77"});var O=e.group.data.allCount,k=O||0===O?"(".concat(e.group.data.allCount,")"):"",w=e.deleteState?a.a.createElement(b.a,{iconProps:{iconName:"Delete"},onClick:function(){return e.onDeleteGroup(e.group)}}):null,j=i?a.a.createElement(Re,{elemId:"group-header-".concat(e.group.key),groupInfo:I,onDismiss:u,onGroupInfoUpdate:e.onGroupHeaderUpdate}):null;return a.a.createElement("div",{ref:d,className:"d-flex p-1 align-items-baseline user-select-none",style:{marginLeft:20*e.groupLevel}},j,y,a.a.createElement(s.a,{id:"group-header-".concat(e.group.key),horizontal:!0,verticalAlign:"baseline",horizontalAlign:"space-between",onClick:function(){return e.onGroupHeaderClick(e.group)},onDoubleClick:function(){return u()}},w,x&&x.length>0?a.a.createElement("h6",null,a.a.createElement("span",{className:"badge bg-primary"},x),"\xa0"):null,a.a.createElement("h6",null,e.group.name," ",k)))}return a.a.createElement("div",null)}function Le(e){var n=e.senseTree,t=Object(r.useState)(!1),o=Object(c.a)(t,2),i=o[0],l=o[1],u=function(n,t){var r=e.senseTree;if(r){var a=oe(r.root,(function(e){return e.node_id==n})),o=oe(r.root,(function(e){return e.node_id==t}));if(a&&o){var i=le(r.root,a,o),c=Object.assign({},r);c.timestamp=Date.now(),c.root=i,e.onSenseTreeUpdated(c),console.log(c)}}},d=function(t){if(n){var r=oe(n.root,(function(e){return e.node_id==t.key}));if(r){var a=Object.assign({},n);(function(e,n){var t,r=n.children,a=se(e,n);a&&((t=e.children).push.apply(t,Object(te.a)(r)),a.children=a.children.filter((function(e){return e!==n})))})(a.root,r);a.timestamp=Date.now(),e.onSenseTreeUpdated(a)}}};return n?a.a.createElement("div",{className:"p-3",style:{boxShadow:Te.a.depth8}},a.a.createElement(s.a,null,a.a.createElement(s.a.Item,null,a.a.createElement(s.a,{horizontal:!0,horizontalAlign:"end"},a.a.createElement(b.a,{iconProps:{iconName:"Add"},onClick:function(){if(n){var t=Object.assign({},n);t.root=function(e){var n=pe();return e.children.unshift(n),e}(t.root),t.timestamp=Date.now(),e.onSenseTreeUpdated(t)}},title:"New Group"}),a.a.createElement(b.a,{title:"Delete",iconProps:{iconName:"Delete"},onClick:function(){l(!i)},checked:i}))),a.a.createElement(s.a.Item,null,a.a.createElement("div",{style:{height:468,overflowY:"auto"}},a.a.createElement(be.a,{items:[],groups:[n.root].map(ae),onRenderCell:function(e,n,t){return a.a.createElement("div",null)},selectionMode:Ee.b.none,groupProps:{onRenderHeader:function(t){if(t){var r=Object(_e.a)(Object(_e.a)({},t),{},{onDragAndDrop:u,onGroupHeaderUpdate:function(r){var a,o=null===t||void 0===t||null===(a=t.group)||void 0===a?void 0:a.key;if(o&&n){var i=Object.assign({},n),c=oe(i.root,(function(e){return e.node_id==o}));c&&(c.title=r.title,c.tag=r.tag,e.onSenseTreeUpdated(i))}},onDeleteGroup:d,deleteState:i});return a.a.createElement(Ue,r)}return a.a.createElement("div",null)},showEmptyGroups:!0,headerProps:{onGroupHeaderClick:function(t){if(n){var r=oe(null===n||void 0===n?void 0:n.root,(function(e){return e.node_id==t.key}));r&&e.onSelectedNodeUpdated(r)}}}},compact:!0}))))):null}var Me=t(182),He=t(175);function Fe(e){var n=e.senseCandidates.map((function(e){return{imageInitials:e.pos,initialsColor:we.a[0],text:e.definition,optionalText:e.cwn_id,styles:{primaryText:{fontSize:"8pt"}}}}));return a.a.createElement(He.a,{selectedItems:n,onResolveSuggestions:function(n){return e.onSenseSuggestions(n).map((function(e,n){return{imageInitials:e.pos,initialsColor:n%6,text:e.definition,optionalText:e.cwn_id}}))},onChange:function(n){n&&e.onPickerChanged(n.map((function(e){return e.optionalText?e.optionalText:""})))}})}function We(e){var n=e.revision,t={height:"30px",width:"30px",fontSize:"100px"},o=Object(r.useState)(!1),i=Object(c.a)(o,2),l=i[0],u=i[1],d=Object(r.useState)(3),p=Object(c.a)(d,2),f=p[0],m=p[1];if(n){var g=[];e.revision&&(g=e.revision.candidates.map((function(n){var t=e.senses.filter((function(e){return e.cwn_id==n}));return t&&t.length>0?t[0]:null})).filter((function(e){return null!==e})));var v=l?a.a.createElement(s.a.Item,{styles:{root:{width:"120px"}}},a.a.createElement(Me.a,{title:"\u6211\u89ba\u5f97\u81ea\u5df1\u975e\u5e38\u4e0d\u78ba\u5b9a\uff081\uff09\u5230\u975e\u5e38\u78ba\u5b9a\uff085\uff09",min:1,max:5,rating:f,onChange:function(e,n){return n?void m(n):null},icon:"CircleFill",unselectedIcon:"CircleRing"})):null;return a.a.createElement(s.a,{horizontal:!0,styles:{root:{width:"100%;"}}},a.a.createElement(s.a.Item,{grow:1},a.a.createElement(Fe,{senseCandidates:g,onPickerChanged:function(t){var r=Object.assign({},n);r.candidates=t,r.timestamp=Date.now(),function(n){e.onSenseRevisionUpdated(n)}(r)},onSenseSuggestions:function(n){return function(e,n,t){var r=e.split(">>"),a=r[0],o=-1;r.length>1&&(o=parseInt(r[1])?parseInt(r[1]):-1);var i=[];return t&&(i=ie(t.root,(function(e){var n;return"group"==e.node_type&&(e.title.indexOf(a)>=0||(null===(n=e.tag)||void 0===n?void 0:n.indexOf(a))>=0)})).map((function(e){return ue(e)})).flatMap((function(e){return e.filter((function(e){return"sense"==e.node.node_type})).map((function(e){return function(e,n){var t=n.map((function(e){return e.cwn_id})).indexOf(e);return t<0?null:n[t]}(e.node.node_id,n)}))})).filter((function(e){return null!==e}))),i.length>0?o>=0?[i[o]]:i:n.filter((function(e){e.cwn_id.startsWith(a)||e.pos.startsWith(a)}))}(n,e.senses,e.senseTree)}})),v,a.a.createElement(s.a.Item,{styles:{root:{width:"100px"}}},a.a.createElement(s.a,{tokens:{childrenGap:2},horizontal:!0,horizontalAlign:"end"},a.a.createElement(b.a,{style:t,iconProps:{iconName:"CheckMark"},title:"\u78ba\u8a8d",ariaLabel:"CheckMark"}),a.a.createElement(b.a,{style:t,iconProps:{iconName:"Communications"},title:"\u9700\u8981\u8a0e\u8ad6",ariaLabel:"Communications",onClick:function(){u(!l)}}))))}return null}function Be(e,n){var t=e.itemId,r=e.assignId,a=function(e){return{annotator:e.userEmail,timestamp:Date.now(),assignId:e.assignId,itemId:e.itemId,candidates:[],probs:[]}}(e);if(r&&t){var o=n[r];o&&t in o.results&&(a=o.results[t])}return a}var Ve=function(e){var n=Object(r.useState)([]),t=Object(c.a)(n,2),o=t[0],i=t[1],s=Object(r.useState)(null),l=Object(c.a)(s,2),u=l[0],d=l[1],p=Object(r.useState)(null),f=Object(c.a)(p,2),m=f[0],g=f[1],v=Object(r.useState)({}),h=Object(c.a)(v,2),b=h[0],E=h[1];function I(n,t){n&&(n=function(e,n){var t=e.root,r=ue(t).filter((function(e){return"sense"==e.node.node_type})).map((function(e){return e.node.node_id})),a=n.filter((function(e){return r.indexOf(e.cwn_id)<0}));if(a.length>0){var o=pe();o.children=a.map(fe),t.children.push(o)}return e}(n,t),function(e,n){var t=z.a.firestore(),r=(e.userId,e.userEmail),a="".concat(r,"-").concat(n.lemma);t.collection("senseTrees").doc(a).set(n)}(e.trial,n)),d(n)}Object(r.useEffect)((function(){!function(e,n){ge.apply(this,arguments)}(e.trial,i)}),[e.trial]),Object(r.useEffect)((function(){(function(e){return ve.apply(this,arguments)})(e.trial).then((function(e){return I(e,o)})).catch((function(e){return console.error(e)}))}),[e.trial,o]),Object(r.useEffect)((function(){var e=null;e=m?de(m,o):u?de(u.root,o):{senses:[],groups:[]},E(e)}),[m,u]);var x=function(n){e.onSenseRevisionUpdated(e.trial,n)},y=Be(e.trial,e.annotations);return a.a.createElement(a.a.Fragment,null,a.a.createElement("div",{className:"row"},a.a.createElement(We,{revision:y,senses:o,senseTree:u,onSenseRevisionUpdated:x})),a.a.createElement("div",{className:"row"},a.a.createElement("div",{className:"col-6"},a.a.createElement(Le,{senseTree:u,onSelectedNodeUpdated:function(e){g(e)},onSenseTreeUpdated:function(e){return I(e,o)}})),a.a.createElement("div",{className:"col-6"},a.a.createElement(Ne,{senseTree:u,groupedSenses:b,onSenseTreeUpdated:function(e){return I(e,o)},onSenseSelected:function(n){var t=Be(e.trial,e.annotations),r=Object.assign({},t);r.timestamp=Date.now(),r.candidates.indexOf(n.cwn_id)<0&&(r.candidates.push(n.cwn_id),r.probs=r.candidates.map((function(e){return 1/r.candidates.length})),x(r))}}))))};t(131);var Ye=function(){var e=Object(r.useState)(null),n=Object(c.a)(e,2),t=n[0],o=n[1],i=Object(r.useState)(null),s=Object(c.a)(i,2),l=s[0],u=s[1],d=Object(r.useState)({}),p=Object(c.a)(d,2),f=p[0],m=p[1],g=Object(r.useState)([]),v=Object(c.a)(g,2),h=v[0],b=v[1],E=Object(r.useState)({}),I=Object(c.a)(E,2),x=I[0],y=I[1];Object(r.useEffect)((function(){var e,n;C.initializeApp({apiKey:"AIzaSyCtaBIZ-IiQ0a5Z0LsuEnVGmojJbY9yvMs",authDomain:"langon-281613.firebaseapp.com",databaseURL:"https://langon-281613.firebaseio.com",projectId:"langon-281613",storageBucket:"langon-281613.appspot.com",messagingSenderId:"98385288306",appId:"1:98385288306:web:09cdd581f06c0e3cdb76eb",measurementId:"G-36C7NTBFN0"}),C.analytics(),e=function(e){return o(e)},n=function(){return o(null)},C.auth().onAuthStateChanged((function(t){if(t){var r=D(t);e(r)}else n()}))}),[]),Object(r.useEffect)((function(){!function(e,n){J.apply(this,arguments)}(t,u)}),[t]),Object(r.useEffect)((function(){!function(e,n){Z.apply(this,arguments)}(t,b)}),[t]),Object(r.useEffect)((function(){!function(e,n){q.apply(this,arguments)}(t,m)}),[t]),Object(r.useEffect)((function(){!function(e,n){K.apply(this,arguments)}(l,y)}),[l,h]),Object(r.useEffect)((function(){if(l&&h&&h.length>0){var e=l.currentItemId,n=l.currentAssignmentId;if(e.length*n.length===0){var t=Q(l,h[0].assignId,h[0].items[0]);k(t)}}}),[l,h]);var O=l?l.currentItemId:"",k=function(e){u(e),function(e){var n=z.a.firestore(),t=(e.userId,e.userEmail);n.collection("sessions").doc(t).set(e)}(e)},w=function(e){var n;n=e,z.a.firestore().collection("annotations").doc(n.annotId).set(n)};return a.a.createElement("div",{className:"container"},a.a.createElement("div",{className:"row"},a.a.createElement("div",{className:"col-md-3 col-sm-6 d-none d-sm-block",style:{background:"radial-gradient(circle at bottom left, rgba(0,0,0,1) 0%, rgba(75,75,75,1) 100%)",borderRight:"2px dashed darkblue",color:"white"}},a.a.createElement($,{user:t,session:l,assignments:h,annotations:f,onSessionUpdated:k,login_fn:N,logout_fn:T})),a.a.createElement("div",{className:"col-md-9 col-sm-6 col-xs-12"},a.a.createElement(ne,{itemId:O,sentence:x.sentence}),a.a.createElement(Ve,{trial:x,annotations:f,onSenseRevisionUpdated:function(e,n){return function(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(e&&t){var r=n.assignId,a=n.itemId,o=Object.assign({},f),i=o[r];i?i.results[a]=t:((i=X(r,e)).results[a]=t,o[r]=i),m(o),w(i)}}(l,e,n)}}))))},Je=t(174),Ze=t(99),qe=t(97);t(132);Object(qe.a)();var Ke=function(){return a.a.createElement(Je.a,{backend:Ze.a},a.a.createElement(Ye,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));t(133);i.a.render(a.a.createElement(a.a.StrictMode,null,a.a.createElement(Ke,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[114,1,2]]]);
//# sourceMappingURL=main.a51fe67a.chunk.js.map