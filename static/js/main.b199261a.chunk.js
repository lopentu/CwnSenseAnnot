(this["webpackJsonpsense-annot"]=this["webpackJsonpsense-annot"]||[]).push([[0],{121:function(e,n,t){e.exports=t(142)},126:function(e,n,t){},135:function(e,n,t){},139:function(e,n,t){},140:function(e,n,t){},142:function(e,n,t){"use strict";t.r(n);var r=t(0),a=t.n(r),o=t(43),i=t.n(o),s=(t(126),t(8)),c=t(197),l=t(207);function u(e){var n={root:{color:"white",fontSize:"small",textDecoration:"underline"}};return e.user?a.a.createElement(c.a,{horizontal:!0},a.a.createElement("div",null,e.user.name),a.a.createElement("div",{style:{paddingLeft:"10pt"}},a.a.createElement(l.a,{styles:n,onClick:e.logout_fn},"Logout"))):a.a.createElement(c.a,{horizontal:!0},a.a.createElement("div",null,"Not logged in"),a.a.createElement("div",null,a.a.createElement(l.a,{styles:n,onClick:e.login_fn},"Login")))}function d(e){if(null!==e.session){var n=e.session,t=new Date(n.lastActivity).toLocaleString("en-GB");return a.a.createElement(c.a,{id:"session-wrapper"},a.a.createElement("div",{style:{fontSize:"small"}},"Last activity:"),a.a.createElement("div",{style:{fontSize:"small"}},t))}return a.a.createElement(c.a,{id:"session-wrapper"})}var f=t(210),p=t(211);function m(e,n,t){return n.map((function(n){var r=n.assignId,a=n.items.length,o=0,i=0;if(r in t){var s=function(e,n){return Object.values(e[n].results).reduce((function(e,n){return n.probs.length>0&&(e.nDone+=n.probs[0]>=.8?1:0,e.nAmbig+=n.probs[0]<.8?1:0),e}),{nDone:0,nAmbig:0})}(t,r);o=s.nDone,i=s.nAmbig}return{name:n.assignId,nTotal:a,nDone:o,nAmbig:i,checked:n.assignId===e}}))}var g,h=t(71),v=t(213),b=t(95),E=t(96),I=function(){function e(n,t,r){Object(b.a)(this,e),this.session={},this.assignments=[],this.annotations={},this.session=n,this.assignments=t,this.annotations=r}return Object(E.a)(e,[{key:"nextTrial",value:function(){return this.stepTrial((function(e){return e+1}))}},{key:"prevTrial",value:function(){return this.stepTrial((function(e){return e-1}))}},{key:"nextTodo",value:function(){return this.stepTodo((function(e){return e+1}))}},{key:"prevTodo",value:function(){return this.stepTodo((function(e){return e-1}))}},{key:"nextAmbiguous",value:function(){return this.stepAmbig((function(e){return e+1}))}},{key:"prevAmbiguous",value:function(){return this.stepAmbig((function(e){return e-1}))}},{key:"initializeSession",value:function(){return this.hasAssignments()?this.gotoAssignment(this.assignments[0].assignId):this.session}},{key:"gotoAssignment",value:function(e){try{var n=this.findAssignment(e);return n.items.length>0?this.cloneSession(n.assignId,n.items[0]):this.session}catch(t){return console.error(t),this.session}}},{key:"gotoItemNo",value:function(e){var n=this.session;try{var t=this.findAssignment(this.session.currentAssignmentId);if(e>=0&&e<t.items.length){var r=t.items[e];n=this.cloneSession(t.assignId,r)}}catch(a){console.error("Error when gotoItemNo"),console.error(a)}return n}},{key:"hasAssignments",value:function(){return this.assignments.length>0}},{key:"stepTrial",value:function(e){var n=this.session;try{var t=this.findAssignment(this.session.currentAssignmentId),r=this.findItemNo(t,this.session.currentItemId);if((r=e(r))>=0&&r<t.items.length){var a=t.items[r];n=this.cloneSession(t.assignId,a)}}catch(o){console.error(o)}return n}},{key:"stepTodo",value:function(e){var n=this.session;try{var t=this.findAssignment(this.session.currentAssignmentId),r=this.session.currentItemId,a=t.assignId in this.annotations?Object.keys(this.annotations[t.assignId].results):[],o=t.items.filter((function(e){return e==r||a.indexOf(e)<0})),i=e(o.indexOf(r));if(i>0&&i<o.length){var s=o[i];n=this.cloneSession(t.assignId,s)}}catch(c){console.error(c)}return n}},{key:"stepAmbig",value:function(e){var n=this.session;try{var t=this.findAssignment(this.session.currentAssignmentId),r=this.session.currentItemId,a=t.assignId in this.annotations?this.annotations[t.assignId].results:{},o=t.items.filter((function(e){if(!(e in a))return!1;var n=a[e];return n.probs.length>0&&n.probs[0]>.5})),i=e(o.indexOf(r));if(i>0&&i<o.length){var s=o[i];n=this.cloneSession(t.assignId,s)}}catch(c){console.error(c)}return n}},{key:"findAssignment",value:function(e){var n=this.assignments.filter((function(n){return n.assignId==e}));if(n.length>0)return n[0];throw new Error("Cannot find current assignment (".concat(e,")"))}},{key:"findItemNo",value:function(e,n){var t=void 0!==n?n:this.session.currentItemId,r=e.items.indexOf(t);if(r>=0)return r;throw Error("itemId (".concat(t,") not found in assignment(").concat(e.assignId,")"))}},{key:"cloneSession",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",t=Object.assign({},this.session);e.length>0&&(t.currentAssignmentId=e),n.length>0&&(t.currentItemId=n);try{var r=this.findAssignment(e);t.currentItemNo=this.findItemNo(r,n)}catch(a){console.error(a)}return t.lastActivity=Date.now(),t}}]),e}(),x=t(24),k=t.n(x);function y(e,n){var t=Object(r.useReducer)((function(t,r){var a=t;if(null===t){if(r.type==g.Update){var o=r.payload;a=o.newSession?o.newSession:t}}else a=function(e,n,t,r){var a=new I(e,n,t),o=null,i=r.payload;switch(r.type){case g.Update:o=i.newSession?i.newSession:e;case g.Init:o=a.initializeSession();break;case g.GotoAssignment:o=a.gotoAssignment(i.newAssignId);break;case g.GotoItemNo:o=a.gotoItemNo(i.newItemNo);break;case g.NextTrial:o=a.nextTrial();break;case g.PrevTrial:o=a.prevTrial();break;case g.NextTodo:o=a.nextTodo();break;case g.PrevTodo:o=a.prevTodo();break;case g.NextAmbig:o=a.nextAmbiguous();break;case g.PrevAmbig:o=a.prevAmbiguous();break;default:console.error("Unsupported session action type")}return o}(t,e,n,r);return a}),null),a=Object(s.a)(t,2),o=a[0],i=a[1];return Object(r.useEffect)((function(){o&&(console.log("Upload new session"),function(e){var n=k.a.firestore(),t=e.userId;e.userEmail,n.collection("sessions").doc(t).set(e)}(o))}),[o]),[o,function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};i({type:e,payload:n})}]}function O(e){return a.a.createElement(v.a,{items:e.items,onRenderCell:function(n,t){var r,o={root:{padding:"1px",height:"24pt"},icon:{color:"white"},iconHovered:{color:"white"},rootHovered:{border:"1px solid white",borderRadius:"5px"}},i=(r=e.sessionDispatch,{onAssignIdChanged:function(e){r(g.GotoAssignment,{newAssignId:e})}});if(n){var s="".concat(n.name,"-").concat(n.nDone,"-").concat(n.nAmbig,"-").concat(n.nTotal),l=n.checked?a.a.createElement(h.a,{styles:o,iconProps:{iconName:"MSNVideosSolid"},checked:!1}):a.a.createElement(h.a,{styles:o,onClick:function(){return i.onAssignIdChanged(n.name)},iconProps:{iconName:"MSNVideos"},checked:!1});return a.a.createElement(c.a,{horizontal:!0,key:s},a.a.createElement(c.a.Item,{align:"center"},l),a.a.createElement(c.a.Item,{grow:1,align:"center"},n.name),a.a.createElement(c.a.Item,{align:"center"},n.nDone,"/",n.nAmbig,"/",n.nTotal))}return null}})}!function(e){e.Update="UPDATE",e.Init="INIT",e.GotoAssignment="GOTO_ASSIGNMENT",e.GotoItemNo="GOTO_ITEMNO",e.NextTrial="NEXT_TRIAL",e.PrevTrial="PREV_TRIAL",e.NextTodo="NEXT_TODO",e.PrevTodo="PREV_TODO",e.NextAmbig="NEXT_AMBIG",e.PrevAmbig="PREV_AMBIG"}(g||(g={}));var w=t(108),j=t(209),N=t(200);function S(e){var n,t={root:{color:"white",border:"1px solid white",borderRadius:"5px"}},r=(n=e.sessionDispatch,{onItemNoChanged:function(e){n(g.GotoItemNo,{newItemNo:e})},onPrevTrial:function(){n(g.PrevTrial)},onNextTrial:function(){n(g.NextTrial)},onPrevTodo:function(){n(g.PrevTodo)},onNextTodo:function(){n(g.NextTodo)},onPrevAmbig:function(){n(g.PrevAmbig)},onNextAmbig:function(){n(g.NextAmbig)}}),o=(e.currentItemNo+1).toString();return a.a.createElement(a.a.Fragment,null,a.a.createElement(c.a,{horizontal:!0,horizontalAlign:"space-evenly"},a.a.createElement(w.a,{styles:t,onClick:r.onPrevTrial,iconProps:{iconName:"CaretSolidLeft"},title:"Previous Item"}),a.a.createElement(w.a,{styles:t,onClick:r.onPrevTodo,iconProps:{iconName:"CaretLeft8"},title:"Previous Todo"}),a.a.createElement(w.a,{styles:t,onClick:r.onNextTodo,iconProps:{iconName:"CaretRight8"},title:"Next Todo"}),a.a.createElement(w.a,{styles:t,onClick:r.onNextTrial,iconProps:{iconName:"CaretSolidRight"},title:"Next Item"})),a.a.createElement(c.a,{horizontal:!0},a.a.createElement(c.a.Item,null,a.a.createElement(j.a,{styles:{root:{color:"white",minWidth:"70px"}}},"Go to Item")),a.a.createElement(c.a.Item,{grow:1},a.a.createElement(N.a,{styles:{root:{width:"100%"}},key:o,defaultValue:o,onKeyPress:function(e){if("Enter"===e.key){var n=e.target,t=parseInt(n.value);void 0==t||isNaN(t)||r.onItemNoChanged(t-1)}}}))))}function T(e){e.assignments,e.annotations;if(null===e.session)return null;var n=e.session,t=m(n.currentAssignmentId,e.assignments,e.annotations),r=function(e){var n=e.reduce((function(e,n){return e.nDone+=n.nDone,e.nTotal+=n.nTotal,e}),{nDone:0,nTotal:0});return n.nDone/n.nTotal}(t);return a.a.createElement(c.a,{tokens:{childrenGap:10}},a.a.createElement(f.a,{styles:{itemName:{color:"white"}},label:"".concat(Math.round(1e4*r)/100,"% Complete"),percentComplete:r}),a.a.createElement(S,{currentItemNo:n.currentItemNo,sessionDispatch:e.sessionDispatch}),a.a.createElement(p.a,null),a.a.createElement(O,{sessionDispatch:e.sessionDispatch,items:t}))}var C=function(e){return a.a.createElement(c.a,{tokens:{childrenGap:5,padding:10}},a.a.createElement(u,{user:e.user,login_fn:e.login_fn,logout_fn:e.logout_fn}),a.a.createElement(d,{session:e.session}),a.a.createElement(T,{session:e.session,assignments:e.assignments,annotations:e.annotations,sessionDispatch:e.sessionDispatch}))};t(135);function A(e){var n=e.token,t=e.isFocus,r=e.token[1].endsWith("CATEGORY")?"\u3000":e.token[1];return a.a.createElement(c.a,{horizontalAlign:"center",className:t?"focus-token":""},a.a.createElement("div",{style:{fontSize:"10pt"}},e.simplified?"\u3000":r),a.a.createElement("div",{style:{fontSize:"large",whiteSpace:"nowrap"},title:"".concat(n[2],":").concat(n[3])},n[0])," ")}var D=function(e){var n=e.sentence,t=e.itemId;if(void 0===n)return null;var r=-1;try{r=parseInt(t.split(":")[1])}catch(s){}var o=e.preContext?e.preContext.map((function(e,n){return a.a.createElement(A,{token:e,simplified:!0})})):null,i=e.postContext?e.postContext.map((function(e,n){return a.a.createElement(A,{token:e,simplified:!0})})):null;return a.a.createElement("div",{className:"row"},a.a.createElement("div",{className:"mx-auto mt-4"},a.a.createElement("div",{className:"card-body bg-light p-3 mb-3 border border-primary rounded-lg"},a.a.createElement(c.a,{horizontal:!0,horizontalAlign:"center",tokens:{childrenGap:3},styles:{root:{padding:"12pt 0",overflowX:"auto"}}},o,n.map((function(e,n){var t=r==n;return a.a.createElement(A,{token:e,isFocus:t})})),i))))},_=t(9),P=t.n(_),z=t(13),R=t(28);t(91);function G(e){var n=function(e){return e||""};return{name:n(e.displayName),email:n(e.email),photoUrl:n(e.photoURL),uid:n(e.uid)}}function U(){return L.apply(this,arguments)}function L(){return(L=Object(z.a)(P.a.mark((function e(){var n,t,r,a;return P.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("login function called"),n=new R.auth.GoogleAuthProvider,e.prev=2,e.next=5,R.auth().setPersistence(R.auth.Auth.Persistence.LOCAL).then((function(){return R.auth().signInWithPopup(n)}));case 5:if(!(t=e.sent).credential){e.next=12;break}return t.credential.accessToken,r=null,(a=t.user)&&(r=G(a)),e.abrupt("return",r);case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(2),console.debug(e.t0);case 17:case"end":return e.stop()}}),e,null,[[2,14]])})))).apply(this,arguments)}function M(){R.auth().signOut()}function B(e){return V.apply(this,arguments)}function V(){return(V=Object(z.a)(P.a.mark((function e(n){var t,r,a;return P.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=k.a.firestore(),e.next=3,t.collection("senses").doc(n).get();case 3:if(!(r=e.sent).exists){e.next=9;break}return a=r.data(),e.abrupt("return",a.senses);case 9:throw new Error("Cannot find lemma "+n);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function W(e){return H.apply(this,arguments)}function H(){return(H=Object(z.a)(P.a.mark((function e(n){var t,r;return P.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=k.a.firestore(),e.next=3,t.collection("sessions").doc(n.uid).get();case 3:if(!(r=e.sent).exists){e.next=8;break}return e.abrupt("return",r.data());case 8:return e.abrupt("return",null);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function F(e){return X.apply(this,arguments)}function X(){return(X=Object(z.a)(P.a.mark((function e(n){var t,r,a;return P.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=k.a.firestore(),e.next=3,t.collection("assignments").where("annotatorId","==",n.uid).get();case 3:return r=e.sent,a=[],r.forEach((function(e){a.push(e.data())})),e.abrupt("return",a);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Y(e){return J.apply(this,arguments)}function J(){return(J=Object(z.a)(P.a.mark((function e(n){var t,r,a;return P.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=k.a.firestore(),e.next=3,t.collection("annotations").where("annotatorId","==",n.uid).get();case 3:return r=e.sent,a={},r.forEach((function(e){var n=e.data();a[n.assignId]=n})),e.abrupt("return",a);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function K(e){return Z.apply(this,arguments)}function Z(){return(Z=Object(z.a)(P.a.mark((function e(n){var t,r,a,o;return P.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=k.a.firestore(),e.next=3,t.collection("sentences").doc(n).get();case 3:if(!(r=e.sent).exists){e.next=10;break}return a=r.data(),o=a.tokens.map((function(e){return e.split("::")})),e.abrupt("return",o);case 10:return e.abrupt("return",[]);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function q(e,n){return Q.apply(this,arguments)}function Q(){return(Q=Object(z.a)(P.a.mark((function e(n,t){var r,a,o,i;return P.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=k.a.firestore(),a="".concat(n,"-").concat(t),o=null,e.next=5,r.collection("senseTrees").doc(a).get();case 5:return(i=e.sent).exists&&(o=i.data()),e.abrupt("return",o);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var $=t(49);function ee(e){return e.children.length>0?e.children.map((function(e){return"group"===e.node_type?ee(e):1})).reduce((function(e,n){return e+n}),0):0}function ne(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,t=e.children.filter((function(e){return"group"===e.node_type})).map((function(e){return ne(e,n+1)})),r={key:e.node_id,name:e.title,data:{tag:e.tag,description:e.description,allCount:ee(e)},level:n,children:t};return r}function te(e,n){var t=re(e,n);return t.length>0?t[0]:null}function re(e,n){return ae(e,n).map((function(e){return e[e.length-1]}))}function ae(e,n){for(var t=[[e,[]]],r=[],a=function(){var e=t.pop(),a=Object(s.a)(e,2),o=a[0],i=a[1],c=[].concat(Object($.a)(i),[o]);n(o)&&r.push(c),o.children.map((function(e){return t.push([e,c])}))};t.length>0;)a();return r}function oe(e,n){var t=ae(e,(function(e){return e==n}));return t.length&&t[0].length>1?t[0][t[0].length-2]:null}function ie(e,n,t){var r=Object.assign({},e),a=oe(r,t),o=oe(r,n);if("group"===t.node_type){var i=null!=te(n,(function(e){return e==t}));if(o&&!i){var s=o.children.indexOf(n);o.children.splice(s,1),t.children.push(n)}}else if(a&&o){var c=o.children.indexOf(n);o.children.splice(c,1);var l=a.children,u=l.indexOf(t),d=[].concat(Object($.a)(l.slice(0,u+1)),[n],Object($.a)(l.slice(u+1,l.length)));a.children=d}return r}function se(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return e.children.length>0?e.children.map((function(n){return se(n,e)})).flat():[{node:e,parent:n}]}function ce(e,n,t){var r=se(e).map((function(e){var t=n.map((function(e){return e.cwn_id})).indexOf(e.node.node_id),r=null;return t>=0&&(r=n[t]),{sense:r,parent:e.parent}})).filter((function(e){return!!e.sense})).filter((function(e){return!t||e.sense.cwn_id.indexOf(t)>=0})),a=r.map((function(e){return e.sense})),o=r.map((function(e){return e.parent})),i=a.reduce((function(e,n,t){var r=o[t],a=r?r.node_id:"__null__";return e[a]=[].concat(Object($.a)(e[a]||[]),[n]),e}),{}),s=Object.values(i).flat(),c=Object.keys(i).map((function(n){var t=i[n],r=te(e,(function(e){return e.node_id===n})),a=(null===r||void 0===r?void 0:r.title)?null===r||void 0===r?void 0:r.title:n;return{count:t.length,startIndex:s.indexOf(t[0]),key:n,name:a,data:o.filter((function(e){return e&&e.node_id==n}))[0],level:0}}));return{senses:s,groups:c}}function le(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return{node_id:"group-".concat(Date.now(),"-").concat(n),description:"",node_type:"group",title:e.length>0?e:"\u672a\u547d\u540d\u985e\u5225",tag:"",children:[]}}function ue(e){return{node_id:e.cwn_id,description:"",node_type:"sense",title:"(".concat(e.pos,")").concat(e.definition),tag:"",children:[]}}function de(e,n){var t=e.itemId,r=e.assignId,a=null;if(r&&t){var o=n[r];o&&t in o.results&&(a=o.results[t])}return null===a&&(a=function(e){return{annotator:e.userEmail,timestamp:Date.now(),assignId:e.assignId,itemId:e.itemId,candidates:[],probs:[]}}(e)),a}function fe(e,n,t){var r=Object.assign({},e);return r.timestamp=Date.now(),n&&(r.candidates=n),r.probs=t||r.candidates.map((function(e){return 1/r.candidates.length})),r}function pe(e){return{annotator:e.userEmail,annotatorId:e.userId,timestamp:Date.now(),lemma:e.token[0],root:le("\u300c".concat(e.token[0],"\u300d\u7684\u8a5e\u610f"))}}function me(){return(me=Object(z.a)(P.a.mark((function e(n,t){var r,a,o;return P.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.token,a=[],!r){e.next=13;break}return o=r[0],e.prev=4,e.next=7,B(o);case 7:a=e.sent,e.next=13;break;case 10:e.prev=10,e.t0=e.catch(4),console.error(e.t0);case 13:return t(a),e.abrupt("return",a);case 15:case"end":return e.stop()}}),e,null,[[4,10]])})))).apply(this,arguments)}function ge(){return(ge=Object(z.a)(P.a.mark((function e(n){var t,r,a,o;return P.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=null,!n||!n.token){e.next=14;break}return r=n.userEmail,a=n.token,o=a[0],e.prev=5,e.next=8,q(r,o);case 8:t=e.sent,e.next=13;break;case 11:e.prev=11,e.t0=e.catch(5);case 13:null===t&&(t=pe(n));case 14:return e.abrupt("return",t);case 15:case"end":return e.stop()}}),e,null,[[5,11]])})))).apply(this,arguments)}var he=t(189),ve=t(193),be=t(25),Ee=t(80),Ie=t(199),xe=t(56),ke=t(11),ye=t(196),Oe=t(3),we=t(202),je=t(203);var Ne=function(e){var n=e.sense,t=e.index,o=Object(r.useRef)(null),i=Object(we.a)({item:{type:"leaf-node",senseId:n.cwn_id},collect:function(e){return{isDragging:!!e.isDragging()}}}),c=Object(s.a)(i,2);Object(Ee.a)(c[0]);var l,u=c[1],d=Object(je.a)({accept:"leaf-node",drop:function(t,r){e.onDragAndDrop(t.senseId,n.cwn_id)},canDrop:function(e,n){return!0}}),f=Object(s.a)(d,2);return Object(Ee.a)(f[0]),u((0,f[1])(o)),n&&void 0!==t?a.a.createElement("div",{ref:o},a.a.createElement(Ie.a,{tooltipProps:(l=n.examples,{onRenderContent:function(){return a.a.createElement("ul",null,l.map((function(e){return a.a.createElement("li",{key:e.substr(0,5)+e.length.toString()},e)})))}}),id:"tp"+n.cwn_id,delay:xe.a.long,directionalHint:ke.a.rightCenter},a.a.createElement(ye.a,{key:"sense-item-".concat(n.cwn_id),imageInitials:n.pos,initialsColor:t%6,text:n.definition,secondaryText:n.examples[0],size:Oe.c.size32,showSecondaryText:!0,onClick:e.onClick,styles:{root:{marginTop:"7px",userSelect:"none"},primaryText:{fontSize:"11pt",userSelect:"none"},secondaryText:{fontSize:"8pt",color:"gray",userSelect:"none"}}}))):a.a.createElement("div",null)},Se=new he.a({onSelectionChanged:function(){console.log(Se.getSelection())}});function Te(e){var n=[],t=[],o=Object(r.useState)(null),i=Object(s.a)(o,2);i[0],i[1];function l(n,t){var r=e.senseTree;if(r){var a=te(r.root,(function(e){return e.node_id==n})),o=te(r.root,(function(e){return e.node_id==t}));if(a&&o){var i=ie(r.root,a,o),s=Object.assign({},r);s.timestamp=Date.now(),s.root=i,e.onSenseTreeUpdated(s)}}}Object.keys(e.groupedSenses).length>0&&(n=e.groupedSenses.senses,t=e.groupedSenses.groups);return a.a.createElement(c.a,null,a.a.createElement("div",{id:"unique-sense-list-id",ref:null,style:{height:"500px",overflowX:"hidden",overflowY:"scroll"}},a.a.createElement(ve.a,{items:n,groups:t,onRenderCell:function(n,t,r){if(t&&void 0!==r)return a.a.createElement(Ne,{sense:t,index:r,onDragAndDrop:l,onClick:function(){return function(n){var t=e.senseRevision;console.log("onSenseSelected (senseRevision): ",t);var r=t.candidates;if(t.candidates.indexOf(n.cwn_id)<0){r.push(n.cwn_id);var a=fe(t,r=r);e.onSenseRevisionUpdated(a)}}(t)}})},compact:!0,selectionMode:be.b.none,groupProps:{showEmptyGroups:!0}})))}var Ce=t(36),Ae=t(102),De=t(4),_e=t(190),Pe=t(205),ze=t(101);function Re(e){var n=Object(r.useState)(e.groupInfo),t=Object(s.a)(n,2),o=t[0],i=t[1],l=Object(De.B)({root:{padding:"5%"},label:{width:"60px",margin:"1% 0%"},textInput:{}});return a.a.createElement(_e.a,{role:"alertdialog",gapSpace:0,target:"#".concat(e.elemId),onDismiss:e.onDismiss,setInitialFocus:!0},a.a.createElement(c.a,{className:l.root},a.a.createElement(c.a,{horizontal:!0},a.a.createElement(j.a,{className:l.label},"Title"),a.a.createElement(N.a,{className:l.textInput,onChange:function(e,n){return i(Object(Ce.a)(Object(Ce.a)({},o),{},{title:n||""}))},defaultValue:o.title})),a.a.createElement(c.a,{horizontal:!0},a.a.createElement(j.a,{className:l.label},"Tag"),a.a.createElement(N.a,{className:l.textInput,onChange:function(e,n){return i(Object(Ce.a)(Object(Ce.a)({},o),{},{tag:n||""}))},defaultValue:o.tag})),a.a.createElement(c.a,{horizontal:!0,horizontalAlign:"end",tokens:{childrenGap:"10px"},styles:{root:{paddingTop:"16px"}}},a.a.createElement(Pe.a,{onClick:e.onDismiss},"Cancel"),a.a.createElement(ze.a,{onClick:function(){i(o),e.onGroupInfoUpdate(o),e.onDismiss()}},"Save"))))}function Ge(e){var n=function(){e.onToggleCollapse(e.group)},t=Object(r.useState)(!1),o=Object(s.a)(t,2),i=o[0],l=o[1],u=function(){l(!i)},d=Object(r.useRef)(null),f=Object(je.a)({accept:["group-node","leaf-node"],drop:function(n,t){var r=e.group.key;"group-node"==n.type?e.onDragAndDrop(n.nodeId,r):e.onDragAndDrop(n.senseId,r)},canDrop:function(n,t){return"leaf-node"==n.type||n.nodeId!=e.group.key}}),p=Object(s.a)(f,2),m=p[0],g=(m.isOver,m.canDrop,p[1]),h=Object(we.a)({item:{type:"group-node",nodeId:e.group.key},collect:function(e){return{isDragging:!!e.isDragging()}}}),v=Object(s.a)(h,3),b=(v[0].isDragging,v[1]);v[2];if(e.group){b(g(d));var E={title:e.group.name,tag:e.group.data.tag},I=E.tag,x=null;x=e.group.isCollapsed?a.a.createElement(w.a,{onClick:n,iconProps:{iconName:"ChevronDown"},title:"\u5c55\u958b"}):a.a.createElement(w.a,{onClick:n,iconProps:{iconName:"ChevronRight"},title:"\u6536\u8d77"});var k=e.group.data.allCount,y=k||0===k?"(".concat(e.group.data.allCount,")"):"",O=e.deleteState?a.a.createElement(w.a,{iconProps:{iconName:"Delete"},onClick:function(){return e.onDeleteGroup(e.group)}}):null,j=i?a.a.createElement(Re,{elemId:"group-header-".concat(e.group.key),groupInfo:E,onDismiss:u,onGroupInfoUpdate:e.onGroupHeaderUpdate}):null;return a.a.createElement("div",{ref:d,className:"d-flex p-1 align-items-baseline user-select-none",style:{marginLeft:20*e.groupLevel}},j,x,a.a.createElement(c.a,{id:"group-header-".concat(e.group.key),horizontal:!0,verticalAlign:"baseline",horizontalAlign:"space-between",onClick:function(){return e.onGroupHeaderClick(e.group)},onDoubleClick:function(){return u()}},O,I&&I.length>0?a.a.createElement("h6",null,a.a.createElement("span",{className:"badge bg-primary"},I),"\xa0"):null,a.a.createElement("h6",null,e.group.name," ",y)))}return a.a.createElement("div",null)}var Ue=t(42),Le=t(194),Me=t(106),Be=t(72);function Ve(e){var n={type:Ue.a.normal,title:"\u78ba\u8a8d\u8981\u91cd\u65b0\u5206\u985e\u55ce",closeButtonAriaLabel:"Close",subText:"\u9019\u6703\u5b8c\u5168\u79fb\u9664\u73fe\u6709\u7684\u8a5e\u610f\u5206\u985e\uff0c\u4e14\u7121\u6cd5\u5fa9\u539f\u3002\u78ba\u8a8d\u8981\u91cd\u65b0\u5206\u985e\u55ce\uff1f"};return a.a.createElement(Le.a,{hidden:e.hideDialog,onDismiss:e.onDismiss,dialogContentProps:n},a.a.createElement(Me.a,null,a.a.createElement(ze.a,{onClick:e.onConfirmReset,styles:{root:{backgroundColor:De.d.red}},text:"\u78ba\u5b9a"}),a.a.createElement(Be.a,{onClick:e.onDismiss,text:"\u53d6\u6d88"})))}function We(e){var n=e.senseTree,t=Object(r.useState)(!1),o=Object(s.a)(t,2),i=o[0],l=o[1],u=Object(r.useState)(!1),d=Object(s.a)(u,2),f=d[0],p=d[1],m=function(n,t){var r=e.senseTree;if(r){var a=te(r.root,(function(e){return e.node_id==n})),o=te(r.root,(function(e){return e.node_id==t}));if(a&&o){var i=ie(r.root,a,o),s=Object.assign({},r);s.timestamp=Date.now(),s.root=i,e.onSenseTreeUpdated(s),console.log(s)}}},g=function(t){if(n){var r=te(n.root,(function(e){return e.node_id==t.key}));if(r){var a=Object.assign({},n);(function(e,n){n.children;var t=oe(e,n);t&&(t.children=t.children.filter((function(e){return e!==n})))})(a.root,r);a.timestamp=Date.now(),e.onSenseTreeUpdated(a)}}},h=function(){p(!f)};return n?a.a.createElement("div",{className:"p-3",style:{boxShadow:Ae.a.depth8}},a.a.createElement(Ve,{hideDialog:!f,onConfirmReset:function(){if(n){var t=Object.assign({},n);t.root=Object.assign({},n.root),t.root.title="\u300c".concat(n.lemma,"\u300d\u7684\u8a5e\u610f"),t.root.children=[],e.onSenseTreeUpdated(t),h()}},onDismiss:h}),a.a.createElement(c.a,null,a.a.createElement(c.a.Item,null,a.a.createElement(c.a,{horizontal:!0,horizontalAlign:"end"},a.a.createElement(w.a,{iconProps:{iconName:"AlbumRemove"},onClick:h,title:"\u91cd\u65b0\u5206\u985e"}),a.a.createElement(w.a,{iconProps:{iconName:"Add"},onClick:function(){if(n){var t=Object.assign({},n);t.root=function(e){var n=le();return e.children.unshift(n),e}(t.root),t.timestamp=Date.now(),e.onSenseTreeUpdated(t)}},title:"\u65b0\u985e\u5225"}),a.a.createElement(w.a,{title:"\u522a\u9664",iconProps:{iconName:"Delete"},onClick:function(){l(!i)},checked:i}))),a.a.createElement(c.a.Item,null,a.a.createElement("div",{style:{height:468,overflowY:"auto"}},a.a.createElement(ve.a,{items:[],groups:[n.root].map(ne),onRenderCell:function(e,n,t){return a.a.createElement("div",null)},selectionMode:be.b.none,groupProps:{onRenderHeader:function(t){if(t){var r=Object(Ce.a)(Object(Ce.a)({},t),{},{onDragAndDrop:m,onGroupHeaderUpdate:function(r){var a,o=null===t||void 0===t||null===(a=t.group)||void 0===a?void 0:a.key;if(o&&n){var i=Object.assign({},n),s=te(i.root,(function(e){return e.node_id==o}));s&&(s.title=r.title,s.tag=r.tag,e.onSenseTreeUpdated(i))}},onDeleteGroup:g,deleteState:i});return a.a.createElement(Ge,r)}return a.a.createElement("div",null)},showEmptyGroups:!0,headerProps:{onGroupHeaderClick:function(t){if(n){var r=te(null===n||void 0===n?void 0:n.root,(function(e){return e.node_id==t.key}));r&&e.onSelectedNodeUpdated(r)}}}},compact:!0}))))):null}var He=t(201),Fe=t(192);function Xe(e){var n=e.senseCandidates.map((function(e){return{imageInitials:e.pos,initialsColor:Oe.a[0],text:e.definition,optionalText:e.cwn_id,styles:{primaryText:{fontSize:"8pt"}}}}));return a.a.createElement(Fe.a,{selectedItems:n,onResolveSuggestions:function(n){return e.onSenseSuggestions(n).map((function(e,n){return{imageInitials:e.pos,initialsColor:n%6,text:e.definition,optionalText:e.cwn_id}}))},onChange:function(n){n&&e.onPickerChanged(n.map((function(e){return e.optionalText?e.optionalText:""})))}})}function Ye(e){return e&&e.probs.length>0?Math.floor(e.probs[0]/.25):4}function Je(e){var n=e.revision,t={height:"30px",width:"30px",fontSize:"100px"},o=Object(r.useState)(Ye(n)),i=Object(s.a)(o,2),l=i[0],u=i[1],d=Object(r.useState)(l<=3),f=Object(s.a)(d,2),p=f[0],m=f[1];if(Object(r.useEffect)((function(){var e=Ye(n);u(e),m(e<=3)}),[e.revision]),n){var h=function(n){e.onSenseRevisionUpdated(n)},v=function(e){if(n){var t=n.candidates,r=1-e/4,a=t.slice(1).map((function(){return r/n.candidates.length}));a.unshift(e/4);var o=fe(n,n.candidates,a);console.log(a),h(o)}},b=n.candidates.map((function(n){var t=e.senses.filter((function(e){return e.cwn_id==n}));return t&&t.length>0?t[0]:null})).filter((function(e){return null!==e})),E=p?a.a.createElement(c.a.Item,{styles:{root:{paddingLeft:"20px",minWidth:"120px"}}},a.a.createElement(He.a,{title:"\u6211\u89ba\u5f97\u81ea\u5df1\u975e\u5e38\u4e0d\u78ba\u5b9a\uff081\uff09\u5230\u975e\u5e38\u78ba\u5b9a\uff085\uff09",min:1,max:4,rating:l,onChange:function(e,n){return n?v(n):null},icon:"CircleFill",unselectedIcon:"CircleRing"})):null;return a.a.createElement(c.a,{horizontal:!0,verticalAlign:"center",styles:{root:{width:"100%;"}}},a.a.createElement(c.a.Item,{grow:1},a.a.createElement(Xe,{senseCandidates:b,onPickerChanged:function(e){if(n){var t=fe(n,e);h(t)}},onSenseSuggestions:function(n){return function(e,n,t){var r=e.split(">>"),a=r[0],o=-1;r.length>1&&(o=parseInt(r[1])?parseInt(r[1]):-1);var i=[];if(t&&(i=re(t.root,(function(e){var n;return"group"==e.node_type&&(e.title.indexOf(a)>=0||(null===(n=e.tag)||void 0===n?void 0:n.indexOf(a))>=0)})).map((function(e){return se(e)})).flatMap((function(e){return e.filter((function(e){return"sense"==e.node.node_type})).map((function(e){return function(e,n){var t=n.map((function(e){return e.cwn_id})).indexOf(e);return t<0?null:n[t]}(e.node.node_id,n)}))})).filter((function(e){return null!==e}))),console.log("senseInGroups",i),i.length>0)return o>=0?[i[o]]:i;var s=n.filter((function(e){return e.cwn_id.startsWith(a)||e.pos.startsWith(a)}));return console.log("filteredSenses",s),s}(n,e.senses,e.senseTree)},onSubmit:function(){e.sessionDispatch(g.NextTodo)}})),E,a.a.createElement(c.a.Item,{styles:{root:{width:"100px"}}},a.a.createElement(c.a,{tokens:{childrenGap:2},horizontal:!0,horizontalAlign:"end"},a.a.createElement(w.a,{style:t,iconProps:{iconName:"CheckMark"},title:"\u78ba\u8a8d",ariaLabel:"CheckMark",disabled:0==n.candidates.length,onClick:function(){e.sessionDispatch(g.NextTodo)}}),a.a.createElement(w.a,{style:t,iconProps:{iconName:"Communications"},title:"\u9700\u8981\u8a0e\u8ad6",ariaLabel:"Communications",onClick:function(){var e=!p;v(e?4:3),m(e)}}))))}return null}var Ke=function(e){var n=de(e.trial,e.annotations),t=Object(r.useState)([]),o=Object(s.a)(t,2),i=o[0],c=o[1],l=Object(r.useState)(null),u=Object(s.a)(l,2),d=u[0],f=u[1],p=Object(r.useState)(null),m=Object(s.a)(p,2),g=m[0],h=m[1],v=Object(r.useState)({}),b=Object(s.a)(v,2),E=b[0],I=b[1],x=Object(r.useState)(n),y=Object(s.a)(x,2),O=y[0],w=y[1];function j(n,t){n&&(n=function(e,n){var t=e.root,r=se(t).filter((function(e){return"sense"==e.node.node_type})).map((function(e){return e.node.node_id})),a=n.filter((function(e){return r.indexOf(e.cwn_id)<0}));if(a.length>0){var o=re(t,(function(e){return e.node_id.endsWith("uncategorized")})),i=0;if(o.length>0){var s=o.map((function(e){return parseInt(e.title.split("-")[1])})).filter((function(e){return!isNaN(e)}));i=s.length>0?Math.max.apply(Math,Object($.a)(s))+1:1}var c=le(0==i?"\u672a\u6b78\u985e":"\u672a\u6b78\u985e-".concat(i),"uncategorized");c.children=a.map(ue),t.children.push(c)}return e}(n,t),function(e,n){var t=k.a.firestore(),r=(e.userId,e.userEmail),a="".concat(r,"-").concat(n.lemma);t.collection("senseTrees").doc(a).set(n)}(e.trial,n)),f(n)}Object(r.useEffect)((function(){var n=function(e,n){return me.apply(this,arguments)}(e.trial,c),t=n.then((function(n){return function(e){return ge.apply(this,arguments)}(e.trial)}));Promise.all([n,t]).then((function(e){var n=Object(s.a)(e,2),t=n[0];j(n[1],t)})).catch((function(e){console.error(e)}))}),[e.trial]),Object(r.useEffect)((function(){var e=null;e=g?ce(g,i):d?ce(d.root,i):{senses:[],groups:[]},I(e)}),[g,d,O]),Object(r.useEffect)((function(){var n=de(e.trial,e.annotations);w(n)}),[e.trial,e.annotations]);var N=function(n){e.onSenseRevisionUpdated(e.trial,n)};return a.a.createElement(a.a.Fragment,null,a.a.createElement("div",{className:"row"},a.a.createElement(Je,{key:"rev-"+O.itemId,revision:O,senses:i,senseTree:d,sessionDispatch:e.sessionDispatch,onSenseRevisionUpdated:N})),a.a.createElement("div",{className:"row"},a.a.createElement("div",{className:"col-6"},a.a.createElement(We,{senseTree:d,onSelectedNodeUpdated:function(e){h(e)},onSenseTreeUpdated:function(e){return j(e,i)}})),a.a.createElement("div",{className:"col-6"},a.a.createElement(Te,{senseTree:d,senseRevision:O,groupedSenses:E,onSenseTreeUpdated:function(e){return j(e,i)},onSenseRevisionUpdated:N}))))};function Ze(){return(Ze=Object(z.a)(P.a.mark((function e(n,t){var r;return P.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=null,null===n){e.next=14;break}return e.prev=2,e.next=5,W(n);case 5:r=e.sent,e.next=11;break;case 8:e.prev=8,e.t0=e.catch(2),console.error("Error in updateSession",e.t0);case 11:null===r&&(r={userId:n.uid,userEmail:n.email,lastActivity:Date.now(),currentAssignmentId:"",currentItemId:"",currentItemNo:NaN}),e.next=15;break;case 14:r=null;case 15:t(g.Update,{newSession:r});case 16:case"end":return e.stop()}}),e,null,[[2,8]])})))).apply(this,arguments)}function qe(){return(qe=Object(z.a)(P.a.mark((function e(n,t){var r;return P.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=[],null===n){e.next=14;break}return e.prev=2,e.next=5,F(n);case 5:r=e.sent,e.next=12;break;case 8:e.prev=8,e.t0=e.catch(2),console.error(e.t0),r=[];case 12:e.next=15;break;case 14:r=[];case 15:t(r);case 16:case"end":return e.stop()}}),e,null,[[2,8]])})))).apply(this,arguments)}function Qe(){return(Qe=Object(z.a)(P.a.mark((function e(n,t){var r;return P.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r={},null===n){e.next=13;break}return e.prev=2,e.next=5,Y(n);case 5:r=e.sent,e.next=11;break;case 8:e.prev=8,e.t0=e.catch(2),console.error(e.t0);case 11:e.next=13;break;case 13:t(r);case 14:case"end":return e.stop()}}),e,null,[[2,8]])})))).apply(this,arguments)}function $e(){return($e=Object(z.a)(P.a.mark((function e(n,t){var r,a,o,i,s,c,l,u,d,f;return P.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r={},!(n&&n.currentItemId.length>0)){e.next=30;break}return a=n.currentItemId,o=n.currentAssignmentId,i=a.split(":")[0],s=parseInt(a.split(":")[1]),e.next=8,K(i);case 8:if(c=e.sent,l=nn(i),u=tn(i),!l){e.next=17;break}return e.next=14,K(l);case 14:e.t0=e.sent,e.next=18;break;case 17:e.t0=[];case 18:if(d=e.t0,!u){e.next=25;break}return e.next=22,K(u);case 22:e.t1=e.sent,e.next=26;break;case 25:e.t1=[];case 26:f=e.t1;try{r={sentenceId:i,sentence:c,preContext:d,postContext:f,token:c[s],userEmail:n.userEmail,userId:n.userId,assignId:o,itemId:a}}catch(p){console.error(p)}e.next=30;break;case 30:t(r);case 31:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function en(e,n){var t=n.userEmail;return{annotId:"".concat(t,":").concat(e),annotatorId:n.userId,assignId:e,results:{}}}function nn(e){return rn(e,"pre")}function tn(e){return rn(e,"post")}function rn(e,n){var t=e.split("-"),r=Object(s.a)(t,2),a=r[0],o=r[1];if(!a||!o)return null;var i=parseInt(o);return isNaN(i)?null:"post"==n?"".concat(a,"-").concat(i+1):"".concat(a,"-").concat(i-1)}t(138),t(139);var an=function(){var e=Object(r.useState)(null),n=Object(s.a)(e,2),t=n[0],o=n[1],i=Object(r.useState)({}),c=Object(s.a)(i,2),l=c[0],u=c[1],d=Object(r.useState)([]),f=Object(s.a)(d,2),p=f[0],m=f[1],h=y(p,l),v=Object(s.a)(h,2),b=v[0],E=v[1],I=Object(r.useState)({}),x=Object(s.a)(I,2),O=x[0],w=x[1];console.log("rendering SenseAnnot"),Object(r.useEffect)((function(){var e,n;R.initializeApp({apiKey:"AIzaSyCtaBIZ-IiQ0a5Z0LsuEnVGmojJbY9yvMs",authDomain:"langon-281613.firebaseapp.com",databaseURL:"https://langon-281613.firebaseio.com",projectId:"langon-281613",storageBucket:"langon-281613.appspot.com",messagingSenderId:"98385288306",appId:"1:98385288306:web:09cdd581f06c0e3cdb76eb",measurementId:"G-36C7NTBFN0"}),R.analytics(),e=function(e){return o(e)},n=function(){return o(null)},R.auth().onAuthStateChanged((function(t){if(t){var r=G(t);e(r)}else n()}))}),[]),Object(r.useEffect)((function(){!function(e,n){Ze.apply(this,arguments)}(t,E)}),[t]),Object(r.useEffect)((function(){!function(e,n){qe.apply(this,arguments)}(t,m)}),[t]),Object(r.useEffect)((function(){!function(e,n){Qe.apply(this,arguments)}(t,u)}),[t]),Object(r.useEffect)((function(){!function(e,n){$e.apply(this,arguments)}(b,w)}),[b,p]),Object(r.useEffect)((function(){b&&0==b.currentAssignmentId.length&&E(g.Init)}),[p]);var j=b?b.currentItemId:"",N=function(e){var n;n=e,k.a.firestore().collection("annotations").doc(n.annotId).set(n)};return a.a.createElement("div",{className:"container position-relative"},a.a.createElement("div",{className:"version-block"},"0.3.0"),a.a.createElement("div",{className:"row"},a.a.createElement("div",{className:"col-md-3 col-sm-6 d-none d-sm-block",style:{background:"radial-gradient(circle at bottom left, rgba(0,0,0,1) 0%, rgba(75,75,75,1) 100%)",borderRight:"2px dashed darkblue",color:"white"}},a.a.createElement(C,{user:t,session:b,assignments:p,annotations:l,sessionDispatch:E,login_fn:U,logout_fn:M})),a.a.createElement("div",{className:"col-md-9 col-sm-6 col-xs-12"},a.a.createElement(D,{itemId:j,sentence:O.sentence,preContext:O.preContext,postContext:O.postContext}),a.a.createElement(Ke,{trial:O,annotations:l,sessionDispatch:E,onSenseRevisionUpdated:function(e,n){return function(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(e&&t){var r=n.assignId,a=n.itemId,o=Object.assign({},l),i=o[r];i?i.results[a]=t:((i=en(r,e)).results[a]=t,o[r]=i),u(o),N(i)}}(b,e,n)}}))))},on=t(191),sn=t(104),cn=t(103);t(140);Object(cn.a)();var ln=function(){return a.a.createElement(on.a,{backend:sn.a},a.a.createElement(an,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));t(141);i.a.render(a.a.createElement(a.a.StrictMode,null,a.a.createElement(ln,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[121,1,2]]]);
//# sourceMappingURL=main.b199261a.chunk.js.map